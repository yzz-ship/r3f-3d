(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3787],{1961:(e,n,t)=>{Promise.resolve().then(t.bind(t,3671))},2596:(e,n,t)=>{"use strict";t.d(n,{A:()=>i});let i=function(){for(var e,n,t=0,i="",r=arguments.length;t<r;t++)(e=arguments[t])&&(n=function e(n){var t,i,r="";if("string"==typeof n||"number"==typeof n)r+=n;else if("object"==typeof n)if(Array.isArray(n)){var s=n.length;for(t=0;t<s;t++)n[t]&&(i=e(n[t]))&&(r&&(r+=" "),r+=i)}else for(i in n)n[i]&&(r&&(r+=" "),r+=i);return r}(e))&&(i&&(i+=" "),i+=n);return i}},3671:(e,n,t)=>{"use strict";t.r(n),t.d(n,{default:()=>b});var i=t(5155),r=t(2115),s=t(7558),a=t(4688),o=t(4274),l=t.n(o),m=t(5355),h=t(6947),d=t(5377),c=t(3264),u=t(802);class v{constructor(e){let n=new c.TDQ(e);this.material=new c.mrM({color:0xffffff});let t=new c.DXC(n,this.material);this.geometry=n,this.mesh=t}}function g(){let e="/r3f-3d",{scene:n,camera:t}=(0,m.A)(),s=(0,h.c)(["1.jpg","2.jpg","3.jpg","4.jpg","5.jpg","6.jpg"],{path:"".concat(e,"/assets/modules/smartCity/textures/")});n.background=s,n.environment=s;let a=(0,d.p)("".concat(e,"/assets/modules/smartCity/model/city.glb"));return(0,r.useEffect)(()=>{a.scene.traverse(e=>{if("Mesh"==e.type&&(e.material=new c.V9B({color:new c.Q1f(790067)}),e.material.onBeforeCompile=n=>{var t,i;n.fragmentShader=n.fragmentShader.replace("#include <dithering_fragment>","\n        #include <dithering_fragment>\n        //#end#\n    "),function(e,n){n.geometry.computeBoundingBox();let{min:t,max:i}=n.geometry.boundingBox,r=i.y-t.y;e.uniforms.uTopColor={value:new c.Q1f("#aaaeff")},e.uniforms.uHeight={value:r},e.vertexShader=e.vertexShader.replace("#include <common>","\n      #include <common>\n      varying vec3 vPosition;\n      "),e.vertexShader=e.vertexShader.replace("#include <begin_vertex>","\n      #include <begin_vertex>\n      vPosition = position;\n  "),e.fragmentShader=e.fragmentShader.replace("#include <common>","\n      #include <common>\n      \n      uniform vec3 uTopColor;\n      uniform float uHeight;\n      varying vec3 vPosition;\n\n        "),e.fragmentShader=e.fragmentShader.replace("//#end#","\n      \n      vec4 distGradColor = gl_FragColor;\n\n      // 设置混合的百分比\n      float gradMix = (vPosition.y+uHeight/2.0)/uHeight;\n      // 计算出混合颜色\n      vec3 gradMixColor = mix(distGradColor.xyz,uTopColor,gradMix);\n      gl_FragColor = vec4(gradMixColor,1);\n        //#end#\n\n      ")}(n,e),function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new c.I9Y(0,0);e.uniforms.uSpreadCenter={value:n},e.uniforms.uSpreadTime={value:-2e3},e.uniforms.uSpreadWidth={value:40},e.fragmentShader=e.fragmentShader.replace("#include <common>","\n      #include <common>\n\n      uniform vec2 uSpreadCenter;\n      uniform float uSpreadTime;\n      uniform float uSpreadWidth;\n      "),e.fragmentShader=e.fragmentShader.replace("//#end#","\n     float spreadRadius = distance(vPosition.xz,uSpreadCenter);\n    //  扩散范围的函数\n    float spreadIndex = -(spreadRadius-uSpreadTime)*(spreadRadius-uSpreadTime)+uSpreadWidth;\n\n    if(spreadIndex>0.0){\n        gl_FragColor = mix(gl_FragColor,vec4(1,1,1,1),spreadIndex/uSpreadWidth);\n    }\n\n    //#end#\n    "),u.Ay.to(e.uniforms.uSpreadTime,{value:800,duration:3,ease:"none",repeat:-1})}(n),(t=n).uniforms.uLightLineTime={value:-1500},t.uniforms.uLightLineWidth={value:200},t.fragmentShader=t.fragmentShader.replace("#include <common>","\n        #include <common>\n  \n        \n        uniform float uLightLineTime;\n        uniform float uLightLineWidth;\n        "),t.fragmentShader=t.fragmentShader.replace("//#end#","\n      float LightLineMix = -(vPosition.x+vPosition.z-uLightLineTime)*(vPosition.x+vPosition.z-uLightLineTime)+uLightLineWidth;\n  \n      if(LightLineMix>0.0){\n          gl_FragColor = mix(gl_FragColor,vec4(0.8,1.0,1.0,1),LightLineMix /uLightLineWidth);\n          \n      }\n  \n      //#end#\n      "),u.Ay.to(t.uniforms.uLightLineTime,{value:1500,duration:5,ease:"none",repeat:-1}),(i=n).uniforms.uToTopTime={value:0},i.uniforms.uToTopWidth={value:40},i.fragmentShader=i.fragmentShader.replace("#include <common>","\n          #include <common>\n    \n          \n          uniform float uToTopTime;\n          uniform float uToTopWidth;\n          "),i.fragmentShader=i.fragmentShader.replace("//#end#","\n        float ToTopMix = -(vPosition.y-uToTopTime)*(vPosition.y-uToTopTime)+uToTopWidth;\n    \n        if(ToTopMix>0.0){\n            gl_FragColor = mix(gl_FragColor,vec4(0.8,0.8,1,1),ToTopMix /uToTopWidth);\n            \n        }\n    \n        //#end#\n        "),u.Ay.to(i.uniforms.uToTopTime,{value:500,duration:3,ease:"none",repeat:-1})},"Layerbuildings"==e.name)){let n=new v(e.geometry),t=e.scale.x;n.mesh.scale.set(t,t,t),a.scene.add(n.mesh)}})},[]),(0,i.jsx)(i.Fragment,{children:(0,i.jsx)("primitive",{object:a.scene})})}class f{remove(){this.mesh.remove(),this.mesh.removeFromParent(),this.mesh.geometry.dispose(),this.mesh.material.dispose()}constructor(e=5,n=2,t={x:0,z:0},i=0xff0000){this.geometry=new c.Ho_(e,e,2,32,1,!0),this.material=new c.BKk({vertexShader:"varying vec3 vPosition;\n\nvoid main(){\n    vec4 viewPosition = viewMatrix * modelMatrix *vec4(position,1);\n    gl_Position = projectionMatrix * viewPosition;\n    vPosition = position;\n    \n}",fragmentShader:"varying vec3 vPosition;\nuniform float uHeight;\nvoid main(){\n    // 设置混合的百分比\n        float gradMix = (vPosition.y+uHeight/2.0)/uHeight;\n      gl_FragColor = vec4(1,1,0,1.0-gradMix);\n    \n}",transparent:!0,side:c.$EB}),this.mesh=new c.eaF(this.geometry,this.material),this.mesh.position.set(t.x,1,t.z),this.mesh.geometry.computeBoundingBox();let{min:r,max:s}=this.mesh.geometry.boundingBox,a=s.y-r.y;this.material.uniforms.uHeight={value:a},u.Ay.to(this.mesh.scale,{x:n,z:n,duration:1,repeat:-1,yoyo:!0})}}class p{remove(){this.mesh.remove(),this.mesh.removeFromParent(),this.mesh.geometry.dispose(),this.mesh.material.dispose()}constructor(e={x:0,z:0},n=65535){let t=[new c.Pq0(0,0,0),new c.Pq0(e.x/2,4,e.z/2),new c.Pq0(e.x,0,e.z)];this.lineCurve=new c.B6O(t);let i=this.lineCurve.getPoints(1e3);this.geometry=new c.LoY().setFromPoints(i);let r=new Float32Array(i.length);for(let e=0;e<r.length;e++)r[e]=e;this.geometry.setAttribute("aSize",new c.THS(r,1)),this.shaderMaterial=new c.BKk({uniforms:{uTime:{value:0},uColor:{value:new c.Q1f(n)},uLength:{value:i.length}},vertexShader:"attribute float aSize;\n\nuniform float uTime;\nuniform vec3 uColor;\nuniform float uLength;\n\nvarying float vSize;\n\nvoid main(){\n    vec4 viewPosition = viewMatrix * modelMatrix *vec4(position,1);\n    gl_Position = projectionMatrix * viewPosition;\n    vSize = (aSize-uTime);\n    if(vSize<0.0){\n        vSize = vSize + uLength; \n    }\n    vSize = (vSize-500.0)*0.1;\n    \n    gl_PointSize = -vSize/viewPosition.z;\n}",fragmentShader:"varying float vSize;\nuniform vec3 uColor;\nvoid main(){\n    float distanceToCenter = distance(gl_PointCoord,vec2(0.5,0.5));\n    float strength = 1.0 - (distanceToCenter*2.0);\n\n    if(vSize<=0.0){\n        gl_FragColor = vec4(1,0,0,0);\n    }else{\n        gl_FragColor = vec4(uColor,strength);\n    }\n    \n}",transparent:!0,depthWrite:!1,blending:c.EZo}),this.mesh=new c.ONl(this.geometry,this.shaderMaterial),u.Ay.to(this.shaderMaterial.uniforms.uTime,{value:1e3,duration:2,repeat:-1,ease:"none"})}}class x{remove(){this.mesh.remove(),this.mesh.removeFromParent(),this.mesh.geometry.dispose(),this.mesh.material.dispose()}constructor(e=2,n={x:0,z:0},t=0xff0000){this.geometry=new c.bdM(e,e),this.material=new c.BKk({uniforms:{uColor:{value:new c.Q1f(t)},uTime:{value:0}},vertexShader:"varying vec3 vPosition;\nvarying vec2 vUv;\n\nvoid main(){\n    vec4 viewPosition = viewMatrix * modelMatrix *vec4(position,1);\n    gl_Position = projectionMatrix * viewPosition;\n    vPosition = position;\n    vUv = uv;\n    \n}",fragmentShader:"varying vec3 vPosition;\nvarying vec2 vUv;\nuniform vec3 uColor;\nuniform float uTime;\n\nmat2 rotate2d(float _angle){\n    return mat2(cos(_angle),-sin(_angle),\n                sin(_angle),cos(_angle));\n}\n\n\nvoid main(){\n    \n    vec2 newUv = rotate2d(uTime*6.28) * (vUv-0.5);\n    newUv += 0.5;\n    float alpha =  1.0 - step(0.5,distance(newUv,vec2(0.5)));\n    \n    float angle = atan(newUv.x-0.5,newUv.y-0.5);\n    float strength = (angle+3.14)/6.28;\n    gl_FragColor =vec4(uColor,alpha*strength);\n\n    \n    \n}",transparent:!0,side:c.$EB}),this.mesh=new c.eaF(this.geometry,this.material),this.mesh.position.set(n.x,1,n.z),this.mesh.rotation.x=-Math.PI/2,u.Ay.to(this.material.uniforms.uTime,{value:1,duration:1,repeat:-1,ease:"none"})}}let y="/r3f-3d";class _{onClick(e){this.fns.push(e)}remove(){this.mesh.remove(),this.mesh.removeFromParent(),this.mesh.geometry.dispose(),this.mesh.material.dispose()}constructor(e="火警",n={x:-1.8,z:3},t=0xffffff){let i=new c.Tap().load({火警:"".concat(y,"/assets/modules/smartCity/textures/tag/fire.png"),治安:"".concat(y,"/assets/modules/smartCity/textures/tag/jingcha.png"),电力:"".concat(y,"/assets/modules/smartCity/textures/tag/e.png")}[e]);this.material=new c.RoJ({map:i,color:t,transparent:!0,depthTest:!1}),this.mesh=new c.kxk(this.material),this.mesh.position.set(n.x,3.5,n.z),this.fns=[],this.raycaster=new c.tBo,this.mouse=new c.I9Y;let r=new c.ubm(75,window.innerHeight/window.innerHeight,1,5e4);r.position.set(5,10,15),window.addEventListener("click",e=>{this.mouse.x=e.clientX/window.innerWidth*2-1,this.mouse.y=-(e.clientY/window.innerHeight*2-1),this.raycaster.setFromCamera(this.mouse,r),e.mesh=this.mesh,e.alarm=this,console.log(1),this.raycaster.intersectObject(this.mesh).length>0&&this.fns.forEach(n=>{n(e)})})}}function w(e){let{eventList:n,index:t,setIndex:s}=e,{camera:a,scene:o,controls:l}=(0,m.A)(),h=(0,r.useRef)([]),d=(0,r.useRef)(!1),u={fire_alarm:(e,n)=>{let t=new f(1,2,e);t.eventListIndex=n,o.add(t.mesh),h.current.push(t)},security_alarm:(e,n)=>{let t=new p(e,new c.Q1f(Math.random(),Math.random(),Math.random()).getHex());t.eventListIndex=n,o.add(t.mesh),h.current.push(t)},power_alarm:(e,n)=>{let t=new x(2,e);t.eventListIndex=n,o.add(t.mesh),h.current.push(t)}},v=e=>{h.current.forEach(n=>{n.eventListIndex===e?n.mesh.visible=!0:n.mesh.visible=!1}),y[e].position.x,y[e].position.y},g=()=>{h.current.forEach(e=>{o.remove(e.mesh)}),h.current=[],y.forEach((e,n)=>{let t={x:e.position.x/5-10,z:e.position.y/5-10},i=new _(e.name,t);i.onClick(e=>{let{event:n,i:t}=e;s(t),d.current=!0}),i.eventListIndex=n,h.current.push(i),o.add(i.mesh),u[e.type]&&u[e.type](t,n)})};(0,r.useEffect)(()=>{g()},[]),(0,r.useEffect)(()=>{t>=0&&(d.current||v(t),d.current=!1)},[t]);let y=(0,r.useMemo)(()=>n,[n]);return(0,i.jsx)("group",{})}var S=t(6766),T=t(2596),C=t(8907),j=t.n(C);function P(e){let{dataInfo:n,eventList:t,index:r,setIndex:s}=e,a="/r3f-3d",o={power_alarm:"".concat(a,"/assets/modules/smartCity/bg/dianli.svg"),fire_alarm:"".concat(a,"/assets/modules/smartCity/bg/fire.svg"),security_alarm:"".concat(a,"/assets/modules/smartCity/bg/jingcha.svg")},l=(e,n)=>{s(n),e.stopPropagation()};return(0,i.jsxs)("div",{className:j().bigScreen,children:[(0,i.jsx)("div",{className:j().header,children:"智慧城市管理系统平台"}),(0,i.jsxs)("div",{className:j().main,children:[(0,i.jsx)("div",{className:j().left,children:Object.keys(n).map((e,t)=>(0,i.jsxs)("div",{className:j().cityEvent,children:[(0,i.jsx)("h3",{className:j().h3,children:(0,i.jsx)("span",{children:n[e].name})}),(0,i.jsxs)("h1",{className:j().h1,children:[(0,i.jsx)("img",{src:"".concat(a,"/assets/modules/smartCity/bg/bar.svg"),className:j().icon}),(0,i.jsxs)("span",{children:[n[e].number,"（",n[e].unit,"）"]})]}),(0,i.jsx)("div",{className:j().footerBoder})]},t))}),(0,i.jsx)("div",{className:j().right,children:(0,i.jsxs)("div",{className:(0,T.A)(j().cityEvent,j().list),children:[(0,i.jsx)("h3",{className:j().h3,children:(0,i.jsx)("span",{children:"事件列表"})}),(0,i.jsx)("ul",{children:t.map((e,n)=>(0,i.jsxs)("li",{className:(0,T.A)({[j().active]:r==n}),onClick:e=>l(e,n),children:[(0,i.jsx)("h1",{className:j().h1,children:(0,i.jsxs)("div",{children:[(0,i.jsx)(S.default,{className:j().icon,src:o[e.type],priority:!0,width:20,height:20,alt:"icon"}),(0,i.jsxs)("span",{children:[" ",e.name]})]})}),(0,i.jsx)("p",{children:e.msg})]},n))})]})})]})]})}function b(){let[e,n]=(0,r.useState)(-1),[t,o]=(0,r.useState)(!1),m=[{name:"火警",type:"fire_alarm",msg:"存在隐患,需派人排除隐患",position:{x:10,y:10}},{name:"电力",type:"power_alarm",msg:"出现事故，需紧急处理",position:{x:30,y:30}},{name:"治安",type:"security_alarm",msg:"重大事故，需派人支援",position:{x:50,y:50}}];return(0,i.jsxs)("div",{className:l().wrap,children:[(0,i.jsx)("div",{className:l().canvasWrap,children:(0,i.jsxs)(s.Hl,{dpr:[1.5,2],gl:{antialias:!0},camera:{position:[5,10,15]},fallback:(0,i.jsx)("div",{children:"Sorry no WebGL supported!"}),children:[(0,i.jsx)(a.N,{enableDamping:!0,dampingFactor:.05}),(0,i.jsxs)(r.Suspense,{fallback:null,children:[(0,i.jsx)(w,{eventList:m,index:e,flag:t,setFlag:o,setIndex:n}),(0,i.jsx)(g,{})]})]})}),(0,i.jsx)(P,{eventList:m,dataInfo:{iot:{name:"接入IOT设备",number:2400,unit:"台"},event:{name:"未处理治安事件",number:2400,unit:"起"},power:{name:"城市电力能耗",number:2400,unit:"兆瓦时"},test:{name:"今日核酸采集量",number:1e3,unit:"人"}},index:e,flag:t,setIndex:n})]})}},4274:e=>{e.exports={wrap:"page_wrap__0JQb4",canvasWrap:"page_canvasWrap__7Twoo"}},6947:(e,n,t)=>{"use strict";t.d(n,{c:()=>s}),t(2115);var i=t(3264),r=t(5355);function s(e,{path:n}){let[t]=(0,r.F)(i.ScU,[e],e=>e.setPath(n));return t}s.preload=(e,{path:n})=>r.F.preload(i.ScU,[e],e=>e.setPath(n))},8907:e=>{e.exports={bigScreen:"style_bigScreen__D_Ur8",header:"style_header__rh6e7",main:"style_main__NGFu0",left:"style_left__CdRhi",right:"style_right__PFRPF",cityEvent:"style_cityEvent__I6tq_",footerBorder:"style_footerBorder__RfElu",icon:"style_icon__vP8Gx",h1:"style_h1__WUTEn",h3:"style_h3__iivZN",time:"style_time__WNb1K",list:"style_list__4CaQ7",active:"style_active__qFZ7N",ul:"style_ul__kXcVK",li:"style_li__uvL4c"}}},e=>{var n=n=>e(e.s=n);e.O(0,[2720,1831,9367,8413,3211,3562,4688,6176,5377,802,6766,8441,1684,7358],()=>n(1961)),_N_E=e.O()}]);