(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3787],{1961:(e,n,i)=>{Promise.resolve().then(i.bind(i,3671))},2596:(e,n,i)=>{"use strict";i.d(n,{A:()=>t});let t=function(){for(var e,n,i=0,t="",r=arguments.length;i<r;i++)(e=arguments[i])&&(n=function e(n){var i,t,r="";if("string"==typeof n||"number"==typeof n)r+=n;else if("object"==typeof n)if(Array.isArray(n)){var a=n.length;for(i=0;i<a;i++)n[i]&&(t=e(n[i]))&&(r&&(r+=" "),r+=t)}else for(t in n)n[t]&&(r&&(r+=" "),r+=t);return r}(e))&&(t&&(t+=" "),t+=n);return t}},3671:(e,n,i)=>{"use strict";i.r(n),i.d(n,{default:()=>P});var t=i(5155),r=i(2115),a=i(7558),o=i(4688),s=i(4274),l=i.n(s),m=i(5355),h=i(6947),d=i(5377),u=i(3264),c=i(802);class v{constructor(e){let n=new u.TDQ(e);this.material=new u.mrM({color:0xffffff});let i=new u.DXC(n,this.material);this.geometry=n,this.mesh=i}}function g(){let{scene:e,camera:n}=(0,m.A)(),i=(0,h.c)(["1.jpg","2.jpg","3.jpg","4.jpg","5.jpg","6.jpg"],{path:"/modules/smartCity/textures/"});e.background=i,e.environment=i;let a=(0,d.p)("/modules/smartCity/model/city.glb");return(0,r.useEffect)(()=>{a.scene.traverse(e=>{if("Mesh"==e.type&&(e.material=new u.V9B({color:new u.Q1f(790067)}),e.material.onBeforeCompile=n=>{var i,t;n.fragmentShader=n.fragmentShader.replace("#include <dithering_fragment>","\n        #include <dithering_fragment>\n        //#end#\n    "),function(e,n){n.geometry.computeBoundingBox();let{min:i,max:t}=n.geometry.boundingBox,r=t.y-i.y;e.uniforms.uTopColor={value:new u.Q1f("#aaaeff")},e.uniforms.uHeight={value:r},e.vertexShader=e.vertexShader.replace("#include <common>","\n      #include <common>\n      varying vec3 vPosition;\n      "),e.vertexShader=e.vertexShader.replace("#include <begin_vertex>","\n      #include <begin_vertex>\n      vPosition = position;\n  "),e.fragmentShader=e.fragmentShader.replace("#include <common>","\n      #include <common>\n      \n      uniform vec3 uTopColor;\n      uniform float uHeight;\n      varying vec3 vPosition;\n\n        "),e.fragmentShader=e.fragmentShader.replace("//#end#","\n      \n      vec4 distGradColor = gl_FragColor;\n\n      // 设置混合的百分比\n      float gradMix = (vPosition.y+uHeight/2.0)/uHeight;\n      // 计算出混合颜色\n      vec3 gradMixColor = mix(distGradColor.xyz,uTopColor,gradMix);\n      gl_FragColor = vec4(gradMixColor,1);\n        //#end#\n\n      ")}(n,e),function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new u.I9Y(0,0);e.uniforms.uSpreadCenter={value:n},e.uniforms.uSpreadTime={value:-2e3},e.uniforms.uSpreadWidth={value:40},e.fragmentShader=e.fragmentShader.replace("#include <common>","\n      #include <common>\n\n      uniform vec2 uSpreadCenter;\n      uniform float uSpreadTime;\n      uniform float uSpreadWidth;\n      "),e.fragmentShader=e.fragmentShader.replace("//#end#","\n     float spreadRadius = distance(vPosition.xz,uSpreadCenter);\n    //  扩散范围的函数\n    float spreadIndex = -(spreadRadius-uSpreadTime)*(spreadRadius-uSpreadTime)+uSpreadWidth;\n\n    if(spreadIndex>0.0){\n        gl_FragColor = mix(gl_FragColor,vec4(1,1,1,1),spreadIndex/uSpreadWidth);\n    }\n\n    //#end#\n    "),c.Ay.to(e.uniforms.uSpreadTime,{value:800,duration:3,ease:"none",repeat:-1})}(n),(i=n).uniforms.uLightLineTime={value:-1500},i.uniforms.uLightLineWidth={value:200},i.fragmentShader=i.fragmentShader.replace("#include <common>","\n        #include <common>\n  \n        \n        uniform float uLightLineTime;\n        uniform float uLightLineWidth;\n        "),i.fragmentShader=i.fragmentShader.replace("//#end#","\n      float LightLineMix = -(vPosition.x+vPosition.z-uLightLineTime)*(vPosition.x+vPosition.z-uLightLineTime)+uLightLineWidth;\n  \n      if(LightLineMix>0.0){\n          gl_FragColor = mix(gl_FragColor,vec4(0.8,1.0,1.0,1),LightLineMix /uLightLineWidth);\n          \n      }\n  \n      //#end#\n      "),c.Ay.to(i.uniforms.uLightLineTime,{value:1500,duration:5,ease:"none",repeat:-1}),(t=n).uniforms.uToTopTime={value:0},t.uniforms.uToTopWidth={value:40},t.fragmentShader=t.fragmentShader.replace("#include <common>","\n          #include <common>\n    \n          \n          uniform float uToTopTime;\n          uniform float uToTopWidth;\n          "),t.fragmentShader=t.fragmentShader.replace("//#end#","\n        float ToTopMix = -(vPosition.y-uToTopTime)*(vPosition.y-uToTopTime)+uToTopWidth;\n    \n        if(ToTopMix>0.0){\n            gl_FragColor = mix(gl_FragColor,vec4(0.8,0.8,1,1),ToTopMix /uToTopWidth);\n            \n        }\n    \n        //#end#\n        "),c.Ay.to(t.uniforms.uToTopTime,{value:500,duration:3,ease:"none",repeat:-1})},"Layerbuildings"==e.name)){let n=new v(e.geometry),i=e.scale.x;n.mesh.scale.set(i,i,i),a.scene.add(n.mesh)}})},[]),(0,t.jsx)(t.Fragment,{children:(0,t.jsx)("primitive",{object:a.scene})})}class f{remove(){this.mesh.remove(),this.mesh.removeFromParent(),this.mesh.geometry.dispose(),this.mesh.material.dispose()}constructor(e=5,n=2,i={x:0,z:0},t=0xff0000){this.geometry=new u.Ho_(e,e,2,32,1,!0),this.material=new u.BKk({vertexShader:"varying vec3 vPosition;\n\nvoid main(){\n    vec4 viewPosition = viewMatrix * modelMatrix *vec4(position,1);\n    gl_Position = projectionMatrix * viewPosition;\n    vPosition = position;\n    \n}",fragmentShader:"varying vec3 vPosition;\nuniform float uHeight;\nvoid main(){\n    // 设置混合的百分比\n        float gradMix = (vPosition.y+uHeight/2.0)/uHeight;\n      gl_FragColor = vec4(1,1,0,1.0-gradMix);\n    \n}",transparent:!0,side:u.$EB}),this.mesh=new u.eaF(this.geometry,this.material),this.mesh.position.set(i.x,1,i.z),this.mesh.geometry.computeBoundingBox();let{min:r,max:a}=this.mesh.geometry.boundingBox,o=a.y-r.y;this.material.uniforms.uHeight={value:o},c.Ay.to(this.mesh.scale,{x:n,z:n,duration:1,repeat:-1,yoyo:!0})}}class p{remove(){this.mesh.remove(),this.mesh.removeFromParent(),this.mesh.geometry.dispose(),this.mesh.material.dispose()}constructor(e={x:0,z:0},n=65535){let i=[new u.Pq0(0,0,0),new u.Pq0(e.x/2,4,e.z/2),new u.Pq0(e.x,0,e.z)];this.lineCurve=new u.B6O(i);let t=this.lineCurve.getPoints(1e3);this.geometry=new u.LoY().setFromPoints(t);let r=new Float32Array(t.length);for(let e=0;e<r.length;e++)r[e]=e;this.geometry.setAttribute("aSize",new u.THS(r,1)),this.shaderMaterial=new u.BKk({uniforms:{uTime:{value:0},uColor:{value:new u.Q1f(n)},uLength:{value:t.length}},vertexShader:"attribute float aSize;\n\nuniform float uTime;\nuniform vec3 uColor;\nuniform float uLength;\n\nvarying float vSize;\n\nvoid main(){\n    vec4 viewPosition = viewMatrix * modelMatrix *vec4(position,1);\n    gl_Position = projectionMatrix * viewPosition;\n    vSize = (aSize-uTime);\n    if(vSize<0.0){\n        vSize = vSize + uLength; \n    }\n    vSize = (vSize-500.0)*0.1;\n    \n    gl_PointSize = -vSize/viewPosition.z;\n}",fragmentShader:"varying float vSize;\nuniform vec3 uColor;\nvoid main(){\n    float distanceToCenter = distance(gl_PointCoord,vec2(0.5,0.5));\n    float strength = 1.0 - (distanceToCenter*2.0);\n\n    if(vSize<=0.0){\n        gl_FragColor = vec4(1,0,0,0);\n    }else{\n        gl_FragColor = vec4(uColor,strength);\n    }\n    \n}",transparent:!0,depthWrite:!1,blending:u.EZo}),this.mesh=new u.ONl(this.geometry,this.shaderMaterial),c.Ay.to(this.shaderMaterial.uniforms.uTime,{value:1e3,duration:2,repeat:-1,ease:"none"})}}class x{remove(){this.mesh.remove(),this.mesh.removeFromParent(),this.mesh.geometry.dispose(),this.mesh.material.dispose()}constructor(e=2,n={x:0,z:0},i=0xff0000){this.geometry=new u.bdM(e,e),this.material=new u.BKk({uniforms:{uColor:{value:new u.Q1f(i)},uTime:{value:0}},vertexShader:"varying vec3 vPosition;\nvarying vec2 vUv;\n\nvoid main(){\n    vec4 viewPosition = viewMatrix * modelMatrix *vec4(position,1);\n    gl_Position = projectionMatrix * viewPosition;\n    vPosition = position;\n    vUv = uv;\n    \n}",fragmentShader:"varying vec3 vPosition;\nvarying vec2 vUv;\nuniform vec3 uColor;\nuniform float uTime;\n\nmat2 rotate2d(float _angle){\n    return mat2(cos(_angle),-sin(_angle),\n                sin(_angle),cos(_angle));\n}\n\n\nvoid main(){\n    \n    vec2 newUv = rotate2d(uTime*6.28) * (vUv-0.5);\n    newUv += 0.5;\n    float alpha =  1.0 - step(0.5,distance(newUv,vec2(0.5)));\n    \n    float angle = atan(newUv.x-0.5,newUv.y-0.5);\n    float strength = (angle+3.14)/6.28;\n    gl_FragColor =vec4(uColor,alpha*strength);\n\n    \n    \n}",transparent:!0,side:u.$EB}),this.mesh=new u.eaF(this.geometry,this.material),this.mesh.position.set(n.x,1,n.z),this.mesh.rotation.x=-Math.PI/2,c.Ay.to(this.material.uniforms.uTime,{value:1,duration:1,repeat:-1,ease:"none"})}}class y{onClick(e){this.fns.push(e)}remove(){this.mesh.remove(),this.mesh.removeFromParent(),this.mesh.geometry.dispose(),this.mesh.material.dispose()}constructor(e="火警",n={x:-1.8,z:3},i=0xffffff){let t=new u.Tap().load({火警:"/modules/smartCity/textures/tag/fire.png",治安:"/modules/smartCity/textures/tag/jingcha.png",电力:"/modules/smartCity/textures/tag/e.png"}[e]);this.material=new u.RoJ({map:t,color:i,transparent:!0,depthTest:!1}),this.mesh=new u.kxk(this.material),this.mesh.position.set(n.x,3.5,n.z),this.fns=[],this.raycaster=new u.tBo,this.mouse=new u.I9Y;let r=new u.ubm(75,window.innerHeight/window.innerHeight,1,5e4);r.position.set(5,10,15),window.addEventListener("click",e=>{this.mouse.x=e.clientX/window.innerWidth*2-1,this.mouse.y=-(e.clientY/window.innerHeight*2-1),this.raycaster.setFromCamera(this.mouse,r),e.mesh=this.mesh,e.alarm=this,console.log(1),this.raycaster.intersectObject(this.mesh).length>0&&this.fns.forEach(n=>{n(e)})})}}function _(e){let{eventList:n,index:i,setIndex:a}=e,{camera:o,scene:s,controls:l}=(0,m.A)(),h=(0,r.useRef)([]),d=(0,r.useRef)(!1),c={fire_alarm:(e,n)=>{let i=new f(1,2,e);i.eventListIndex=n,s.add(i.mesh),h.current.push(i)},security_alarm:(e,n)=>{let i=new p(e,new u.Q1f(Math.random(),Math.random(),Math.random()).getHex());i.eventListIndex=n,s.add(i.mesh),h.current.push(i)},power_alarm:(e,n)=>{let i=new x(2,e);i.eventListIndex=n,s.add(i.mesh),h.current.push(i)}},v=e=>{h.current.forEach(n=>{n.eventListIndex===e?n.mesh.visible=!0:n.mesh.visible=!1}),_[e].position.x,_[e].position.y},g=()=>{h.current.forEach(e=>{s.remove(e.mesh)}),h.current=[],_.forEach((e,n)=>{let i={x:e.position.x/5-10,z:e.position.y/5-10},t=new y(e.name,i);t.onClick(e=>{let{event:n,i}=e;a(i),d.current=!0}),t.eventListIndex=n,h.current.push(t),s.add(t.mesh),c[e.type]&&c[e.type](i,n)})};(0,r.useEffect)(()=>{g()},[]),(0,r.useEffect)(()=>{i>=0&&(d.current||v(i),d.current=!1)},[i]);let _=(0,r.useMemo)(()=>n,[n]);return(0,t.jsx)("group",{})}var w=i(6766),S=i(2596),T=i(8907),C=i.n(T);function j(e){let{dataInfo:n,eventList:i,index:r,setIndex:a}=e,o={power_alarm:"/modules/smartCity/bg/dianli.svg",fire_alarm:"/modules/smartCity/bg/fire.svg",security_alarm:"/modules/smartCity/bg/jingcha.svg"},s=(e,n)=>{a(n),e.stopPropagation()};return(0,t.jsxs)("div",{className:C().bigScreen,children:[(0,t.jsx)("div",{className:C().header,children:"智慧城市管理系统平台"}),(0,t.jsxs)("div",{className:C().main,children:[(0,t.jsx)("div",{className:C().left,children:Object.keys(n).map((e,i)=>(0,t.jsxs)("div",{className:C().cityEvent,children:[(0,t.jsx)("h3",{className:C().h3,children:(0,t.jsx)("span",{children:n[e].name})}),(0,t.jsxs)("h1",{className:C().h1,children:[(0,t.jsx)("img",{src:"/modules/smartCity/bg/bar.svg",className:C().icon}),(0,t.jsxs)("span",{children:[n[e].number,"（",n[e].unit,"）"]})]}),(0,t.jsx)("div",{className:C().footerBoder})]},i))}),(0,t.jsx)("div",{className:C().right,children:(0,t.jsxs)("div",{className:(0,S.A)(C().cityEvent,C().list),children:[(0,t.jsx)("h3",{className:C().h3,children:(0,t.jsx)("span",{children:"事件列表"})}),(0,t.jsx)("ul",{children:i.map((e,n)=>(0,t.jsxs)("li",{className:(0,S.A)({[C().active]:r==n}),onClick:e=>s(e,n),children:[(0,t.jsx)("h1",{className:C().h1,children:(0,t.jsxs)("div",{children:[(0,t.jsx)(w.default,{className:C().icon,src:o[e.type],priority:!0,width:20,height:20,alt:"icon"}),(0,t.jsxs)("span",{children:[" ",e.name]})]})}),(0,t.jsx)("p",{children:e.msg})]},n))})]})})]})]})}function P(){let[e,n]=(0,r.useState)(-1),[i,s]=(0,r.useState)(!1),m=[{name:"火警",type:"fire_alarm",msg:"存在隐患,需派人排除隐患",position:{x:10,y:10}},{name:"电力",type:"power_alarm",msg:"出现事故，需紧急处理",position:{x:30,y:30}},{name:"治安",type:"security_alarm",msg:"重大事故，需派人支援",position:{x:50,y:50}}];return(0,t.jsxs)("div",{className:l().wrap,children:[(0,t.jsx)("div",{className:l().canvasWrap,children:(0,t.jsxs)(a.Hl,{dpr:[1.5,2],gl:{antialias:!0},camera:{position:[5,10,15]},fallback:(0,t.jsx)("div",{children:"Sorry no WebGL supported!"}),children:[(0,t.jsx)(o.N,{enableDamping:!0,dampingFactor:.05}),(0,t.jsxs)(r.Suspense,{fallback:null,children:[(0,t.jsx)(_,{eventList:m,index:e,flag:i,setFlag:s,setIndex:n}),(0,t.jsx)(g,{})]})]})}),(0,t.jsx)(j,{eventList:m,dataInfo:{iot:{name:"接入IOT设备",number:2400,unit:"台"},event:{name:"未处理治安事件",number:2400,unit:"起"},power:{name:"城市电力能耗",number:2400,unit:"兆瓦时"},test:{name:"今日核酸采集量",number:1e3,unit:"人"}},index:e,flag:i,setIndex:n})]})}},4274:e=>{e.exports={wrap:"page_wrap__0JQb4",canvasWrap:"page_canvasWrap__7Twoo"}},6947:(e,n,i)=>{"use strict";i.d(n,{c:()=>a}),i(2115);var t=i(3264),r=i(5355);function a(e,{path:n}){let[i]=(0,r.F)(t.ScU,[e],e=>e.setPath(n));return i}a.preload=(e,{path:n})=>r.F.preload(t.ScU,[e],e=>e.setPath(n))},8907:e=>{e.exports={bigScreen:"style_bigScreen__D_Ur8",header:"style_header__rh6e7",main:"style_main__NGFu0",left:"style_left__CdRhi",right:"style_right__PFRPF",cityEvent:"style_cityEvent__I6tq_",footerBorder:"style_footerBorder__RfElu",icon:"style_icon__vP8Gx",h1:"style_h1__WUTEn",h3:"style_h3__iivZN",time:"style_time__WNb1K",list:"style_list__4CaQ7",active:"style_active__qFZ7N",ul:"style_ul__kXcVK",li:"style_li__uvL4c"}}},e=>{var n=n=>e(e.s=n);e.O(0,[2720,1831,9367,8413,5592,3562,4688,6176,5377,802,6766,8441,1684,7358],()=>n(1961)),_N_E=e.O()}]);